function update_sheet_columns(){sheetIndex=null!=$("#excel_sheet").val()?$("#excel_sheet").val():0,sheetColumns="",null!=file_content&&null!=file_content[sheetIndex]&&null!=file_content[sheetIndex].data[0]&&file_content[sheetIndex].data[0].forEach(function(a,b){sheetColumns+=`<option value="${b}">${escapeHTML(a)}</option>`}),$(".sheet_column").each(function(){$(this).html(sheetColumns)})}function upload_file(){var files=document.getElementById("excel_file").files;if($("#upload_result").fadeOut("fast"),files.length>0){var file=files[0],ext=file.name.split(".").pop();if(allowed_files.indexOf(ext.toLowerCase())>-1){var formData=new FormData;with(t=$('link[rel=stylesheet][href*="css/main"]').attr("href"))assets_base=t.substr(0,t.indexOf("css/main"));$("#file_upload").prepend('<div class="overlay form-loading"><img src="'+assets_base+'/images/loading.gif"</div>'),csrf_token=document.querySelector("meta[name=csrf_token]").getAttribute("content"),formData.append("excel_file",file,file.name),formData.append("csrf_token",csrf_token),formData.append("action","file_upload"),$.ajax({url:"",type:"POST",data:formData,processData:!1,contentType:!1,cache:!1,success:function(a,b,c){try{var d="string"==typeof a?JSON.parse(c.responseText):a}catch(a){var d=!1}if(d&&"success"==d.status)return $("#upload_result").html(get_alert(d.message,"success")).fadeIn("slow"),file_content=d.data,$("#upload_file a.goto-next").click(),$("#sheet_config .overlay").fadeOut("slow"),$("#db_config .overlay").fadeOut("slow"),void(null!=d.data&&(d.data.forEach(function(a,b){$("#excel_sheet").append(`<option value="${b}">${escapeHTML(a.sheet_name)}</option>`)}),update_sheet_columns()));var e=d&&d.message?d.message:"فشل رفع الملف برجاء المحاولة مرّة أخرى";$("#upload_result").html(get_alert(e,"error")).fadeIn("slow")},error:function(){$("#upload_result").html(get_alert("فشل رفع الملف برجاء المحاولة مرّة أخرى!","error")).fadeIn("slow")},complete:function(){$("#file_upload").find(".overlay.form-loading").fadeOut("slow")}})}else $("#upload_result").html(get_alert("الملف الذي تحاول رفعه غير مسموح به... برجاء رفع ملفات Excel فقط.","error")).fadeIn("slow")}}function save_data_callback(a,b){try{result="string"==typeof a?JSON.parse(a):a}catch(a){result=!1}if(result&&"success"==result.status){var c=result.message;$("#finish").fadeIn("slow"),$("#db_config a.goto-next").fadeIn("fast").click()}else{console.log(result);var c=result&&result.message?result.message:"فشل حفظ البيانات برجاء المحاولة مرّة أخرى";$("#db_config .alert").remove(),$("#db_config .content").prepend(get_alert(c)),$("#sheet_config a.goto-next").click()}}var allowed_files=["xls","xlsx","xlsm","xlst","csv"],file_content=null;$("body").on("click","#excel_file",function(){this.value=null}),$("body").on("change","#excel_file",upload_file),$("body").on("change","#excel_sheet",update_sheet_columns);